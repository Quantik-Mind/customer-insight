  name: Quantik Mind ‚Äì Customer Insight
  
  on:
    push:
      branches:
        - main
    workflow_dispatch:
  
  jobs:
    decision-intelligence:
      name: Quantik Mind ‚Äì Decision Intelligence
      runs-on: ubuntu-latest

      steps:
        # ------------------------------------------------------------
        # Checkout
        # ------------------------------------------------------------
        - name: Checkout repository
          uses: actions/checkout@v4
  
        # ------------------------------------------------------------
        # Call Quantik Mind API
        # ------------------------------------------------------------
        - name: Call Quantik Mind ‚Äì Functional Selection
          env:
            API_URL: ${{ secrets.QUANTIK_API_URL }}
            TOKEN: ${{ secrets.QUANTIK_API_TOKEN }}
            PROJECT_ID: ${{ secrets.QUANTIK_PROJECT_ID }}
          run: |
            echo "API_URL set: ${API_URL:+YES}"
            echo "TOKEN set: ${TOKEN:+YES}"
            echo "PROJECT_ID set: ${PROJECT_ID:+YES}"
        
            curl -s -X GET \
              "$API_URL/functional/select?project_id=$PROJECT_ID&lookback_commits_hours=24" \
              -H "Authorization: Bearer $TOKEN" \
              -H "Content-Type: application/json" \
              -o response.json
    
              echo "‚úÖ Response saved to response.json"
              echo ""

        # ------------------------------------------------------------
        # Decision Intelligence Summary
        # ------------------------------------------------------------
        - name: Quantik Mind ‚Äì Decision Intelligence Summary
          run: |
            echo ""
            echo ""
            echo "============================================"
            echo "üß† Quantik Mind ‚Äì Functional Decision Summary"
            echo "============================================"
            echo ""
            
            # Validate JSON
            if ! jq empty response.json; then
              echo "‚ùå Invalid JSON response"
              cat response.json
              exit 1
            fi
            
            TOTAL=$(jq -r '.counts.total // "N/A"' response.json)
            SELECTED=$(jq -r '.counts.selected // "N/A"' response.json)
            REDUCTION=$(jq -r '.reduction_percentage // "N/A"' response.json)
            TAU=$(jq -r '.tau // "N/A"' response.json)
            
            echo "üìä Test Selection"
            echo "--------------------------------------------"
            echo "‚Ä¢ Total tests     : $TOTAL"
            echo "‚Ä¢ Selected tests  : $SELECTED"
            echo "‚Ä¢ Reduction       : ${REDUCTION}%"
            echo ""
            
            echo "üß¨ Quantum Signal"
            echo "--------------------------------------------"
            echo "‚Ä¢ Decision Tau    : $TAU"
            echo ""
            
            echo "üß† Commit Awareness"
            echo "--------------------------------------------"
            jq '.commit_consideration // {}' response.json
            
            echo ""
            echo "‚úÖ Quantik Mind decision completed successfully"
            echo ""

            jq '.commit_consideration // {}' response.json
  
            echo ""
            echo "‚úÖ Quantik Mind decision completed successfully"
            echo ""
