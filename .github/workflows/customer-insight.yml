  name: Quantik Mind ‚Äì Customer Insight
  
  on:
    push:
      branches:
        - main
    workflow_dispatch:
  
  jobs:
    decision-intelligence:
      name: Quantik Mind ‚Äì Decision Intelligence
      runs-on: ubuntu-latest

      steps:
        # ------------------------------------------------------------
        # Checkout
        # ------------------------------------------------------------
        - name: Checkout repository
          uses: actions/checkout@v4
  
        - name: Call Quantik Mind ‚Äì Functional Selection (debug)
          env:
            API_URL: ${{ secrets.QUANTIK_API_URL }}
            TOKEN: ${{ secrets.QUANTIK_API_TOKEN }}
            PROJECT_ID: ${{ secrets.QUANTIK_PROJECT_ID }}
          run: |
            set +e   # <-- IMPORTANTISSIMO: non uscire subito
        
            URL="$API_URL/functional/select?project_id=$PROJECT_ID&lookback_commits_hours=24"
        
            echo "Calling URL:"
            echo "$URL"
            echo ""
        
            HTTP_CODE=$(curl -sS -L \
              -H "Authorization: Bearer $TOKEN" \
              -H "Content-Type: application/json" \
              -o response.json \
              -w "%{http_code}" \
              "$URL")
        
            echo ""
            echo "============================================"
            echo "HTTP STATUS: $HTTP_CODE"
            echo "============================================"
            echo ""
        
            echo "üîç RAW RESPONSE BODY"
            echo "--------------------------------------------"
            cat response.json || true
            echo ""
            echo "--------------------------------------------"
            echo ""
        
            # prova jq solo per info, senza rompere il job
            if jq empty response.json >/dev/null 2>&1; then
              echo "‚úÖ Response is valid JSON"
            else
              echo "‚ö†Ô∏è Response is NOT valid JSON"
            fi
        
            echo ""
            echo "End of response inspection"
