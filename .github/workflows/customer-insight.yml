name: Quantik Mind â€“ Customer Insight

on:
  push:
    branches: ["main"]
  workflow_dispatch:

jobs:
  decision-intelligence:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Call Quantik Mind â€“ Functional Selection
        env:
          API_URL: ${{ secrets.QUANTIK_API_URL }}
          TOKEN: ${{ secrets.QUANTIK_API_TOKEN }}
          PROJECT_ID: ${{ secrets.QUANTIK_PROJECT_ID }}
        run: |
          echo "Calling Quantik Mind Functional Selection..."

          curl -s -X POST \
            "$API_URL/functional/select?project_id=$PROJECT_ID" \
            -H "Authorization: Bearer $TOKEN" \
            -H "Content-Type: application/json" \
            -o response.json

          echo "Response saved to response.json"

      - name: Quantik Mind â€“ Decision Intelligence Summary
        run: |
          echo ""
          echo "============================================"
          echo "ðŸ§  Quantik Mind â€“ Functional Decision Summary"
          echo "============================================"
          echo ""

          TOTAL=$(jq '.counts.total' response.json)
          SELECTED=$(jq '.counts.selected' response.json)
          REDUCTION=$(jq '.reduction_percentage' response.json)
          TAU=$(jq '.tau' response.json)

          echo "ðŸ“Š Test Selection"
          echo "--------------------------------------------"
          echo "â€¢ Total tests     : $TOTAL"
          echo "â€¢ Selected tests  : $SELECTED"
          echo "â€¢ Reduction       : ${REDUCTION}%"
          echo ""

          echo "ðŸ§¬ Quantum Signal"
          echo "--------------------------------------------"
          echo "â€¢ Decision Tau    : $TAU"
          echo ""

          echo "ðŸ§  Commit Awareness"
          echo "--------------------------------------------"
          jq '.commit_consideration' response.json

          echo ""
          echo "âœ… Quantik Mind decision completed successfully"
          echo ""
