  name: Quantik Mind â€“ Customer Insight
  
  on:
    push:
      branches:
        - main
    workflow_dispatch:
  
  jobs:
    decision-intelligence:
      name: Quantik Mind â€“ Decision Intelligence
      runs-on: ubuntu-latest

      steps:
        # ------------------------------------------------------------
        # Checkout
        # ------------------------------------------------------------
        - name: Checkout repository
          uses: actions/checkout@v4
  
        # ------------------------------------------------------------
        # Call Quantik Mind API
        # ------------------------------------------------------------
        - name: Call Quantik Mind â€“ Functional Selection
          env:
            API_URL: ${{ secrets.QUANTIK_API_URL }}
            TOKEN: ${{ secrets.QUANTIK_API_TOKEN }}
            PROJECT_ID: ${{ secrets.QUANTIK_PROJECT_ID }}
          run: |
            echo "API_URL set: ${API_URL:+YES}"
            echo "TOKEN set: ${TOKEN:+YES}"
            echo "PROJECT_ID set: ${PROJECT_ID:+YES}"
        
            curl -s -X GET \
              "$API_URL/functional/select?project_id=$PROJECT_ID&lookback_commits_hours=24" \
              -H "Authorization: Bearer $TOKEN" \
              -H "Content-Type: application/json" \
              -o response.json
    
              echo "âœ… Response saved to response.json"
              echo ""

        # ------------------------------------------------------------
        # Decision Intelligence Summary
        # ------------------------------------------------------------
        - name: Quantik Mind â€“ Decision Intelligence Summary
          run: |
            echo ""
            echo "============================================"
            echo "ðŸ§  Quantik Mind â€“ Functional Decision Summary"
            echo "============================================"
            echo ""
  
            TOTAL=$(jq -r '.counts.total // "N/A"' response.json)
            SELECTED=$(jq -r '.counts.selected // "N/A"' response.json)
            REDUCTION=$(jq -r '.reduction_percentage // "N/A"' response.json)
            TAU=$(jq -r '.tau // "N/A"' response.json)
  
            echo "ðŸ“Š Test Selection"
            echo "--------------------------------------------"
            echo "â€¢ Total tests     : $TOTAL"
            echo "â€¢ Selected tests  : $SELECTED"
            echo "â€¢ Reduction       : ${REDUCTION}%"
            echo ""
  
            echo "ðŸ§¬ Quantum Signal"
            echo "--------------------------------------------"
            echo "â€¢ Decision Tau    : $TAU"
            echo ""
  
            echo "ðŸ§  Commit Awareness"
            echo "--------------------------------------------"
            jq '.commit_consideration // {}' response.json
  
            echo ""
            echo "âœ… Quantik Mind decision completed successfully"
            echo ""
